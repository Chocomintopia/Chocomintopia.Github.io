# 代数

单位向量 可以表示向量的方向

$$
\hat{a}=\frac{\vec{a}}{\vert\vert\vec{a}\vert\vert}
$$

在图形学中 如果不特殊说明 **默认缺省的向量是列向量**

$$
\vec{v}=
\begin{pmatrix}
x\\
y
\end{pmatrix}
$$

$$
\vec{v}^{\ T}=(x,\ y)
$$

## 点乘 dot product
两个向量**点乘的结果是得到一个数** 标量

$$
\vec{a}\cdot \vec{b}=\vert\vert\vec{a}\vert\vert\ \vert\vert\vec{b}\vert\vert\ cos\theta
$$

向量$$\vec{a}$$ $$\vec{b}$$ 之间的夹角为 $$\theta$$

$$
cos\theta=\frac{\vec{a}\cdot \vec{b}}{\vert\vert\vec{a}\vert\vert\ \vert\vert\vec{b}\vert\vert}
$$

对于单位向量

$$
cos\theta=\hat{a}\cdot\hat{b}
$$

图形学中 **点乘的作用就是找到两个向量或方向之间的夹角** 在两个向量都是单位向量时更为方便 只需要**两个单位向量之间点乘 就可以得到它们之间夹角的余弦**

$$
\vec{a}\cdot\vec{b}=\vec{b}\cdot\vec{a}
$$

$$
\vec{a}\cdot(\vec{b}+\vec{c})=\vec{a}\cdot\vec{b}+\vec{a}\cdot\vec{c}
$$

$$
(k\vec{a})\cdot\vec{b}=\vec{a}\cdot(k\vec{b})=k(\vec{a}\cdot\vec{b})
$$

***笛卡尔坐标系中的点乘***

二维中 注意到是两个**列向量**相乘

$$
\vec{a}\cdot\vec{b}=
\begin{pmatrix}
a_1\\
a_2
\end{pmatrix}
\cdot
\begin{pmatrix}
b_1\\
b_2
\end{pmatrix}
=a_1b_1+a_2b_2
$$

三维中

$$
\vec{a}\cdot\vec{b}=
\begin{pmatrix}
a_1\\
a_2\\
a_3\\
\end{pmatrix}
\cdot
\begin{pmatrix}
b_1\\
b_2\\
b_3
\end{pmatrix}
=a_1b_1+a_2b_2+a_3b_3
$$

此后 为了便于数学上的迅速理解 本文对于坐标就写成a1 a2 a3 来表示向量a的坐标的3个维度 而不是使用ax ay az / xa xb 之类的含x y z的写法

将点乘写成矩阵乘法形式 转置后变成行向量就可以进行矩阵乘法了

$$
\vec{a}\cdot\vec{b}=\vec{a}^T\vec{b}=(a_1,a_2,a_3)
\begin{pmatrix}
b_1\\
b_2\\
b_3
\end{pmatrix}
=a_1b_1+a_2b_2+a_3b_3
$$

***Projection 投影***

<div align="center">
  <img src="../images/4/1.png" alt="1.png" style="width: 50%; max-width: none;">
</div>


现在希望把 $$\vec{b}$$ 投影到 $$\vec{a}$$ 上去 $$\vec{b}_\perp$$ 和 $$\hat{a}$$ 是同向的

$$
\vec{b}_\perp=\vert\vert\vec{b}\vert\vert cos\theta\ \hat{a}
$$

那么垂直方向的就是 $$\vec{b}-\vec{b}_\perp$$

***两个向量的方向有多接近***

<div align="center">
  <img src="../images/4/2.png" alt="2.png" style="width: 50%; max-width: none;">
</div>


$$\vec{a}$$ 的正方向是上半圆 反方向是下半圆

$$\vec{a}\cdot\vec{b}$$ 大于0 就认为 $$\vec{a}$$ $$\vec{b}$$ 几乎同方向
$$\vec{a}\cdot\vec{c}$$ 小于0 就认为 $$\vec{a}$$ $$\vec{c}$$ 反方向

**若都是单位向量 点乘结果越接近1 两个向量的方向就越接近 越接近-1 两个向量的方向就越相反**

比如金属的高光 入射的光打到金属表面 它会反射 在它发生镜面反射的那个方向附近的一些角度 你是可以看到这个反射的 于是你就可以看到高光 但如果偏离太远就看不到高光 因此需要知道你的观察视角和它反射的方向到底有多接近

## 叉乘 cross product

两个向量**叉乘的结果是得到一个向量**

这个向量的方向和原来的两个向量都垂直 也就是垂直于原来的两个向量所在的平面 方向是右手螺旋定则

$$
\vert\vert\vec{a}\times\vec{b}\vert\vert=\vert\vert\vec{a}\vert\vert\ \vert\vert\vec{b}\vert\vert\ sin\phi
$$

在三维空间中 如果是右手系 已知x轴y轴 就可以通过x轴y轴叉乘得到z轴

$$
\vec{x}\times\vec{y}=+\vec{z}
$$

$$
\vec{y}\times\vec{z}=+\vec{x}
$$

$$
\vec{z}\times\vec{x}=+\vec{y}
$$

$$
\vec{y}\times\vec{x}=-\vec{z}
$$

$$
\vec{z}\times\vec{y}=-\vec{x}
$$

$$
\vec{x}\times\vec{z}=-\vec{y}
$$

$$
\vec{a}\times\vec{b}=-\vec{b}\times\vec{a}
$$

$$
\vec{a}\times\vec{a}=\vec{0}
$$

$$
\vec{a}\times(\vec{b}+\vec{c})=\vec{a}\times\vec{b}+\vec{a}\times\vec{c}
$$

$$
\vec{a}\times(k\vec{b})=k(\vec{a}\times\vec{b})
$$

OpenGL UE都是左手系

***笛卡尔坐标系中的叉乘***

$$
\vec{a}\times\vec{b}=
\begin{pmatrix}
a_2b_3-a_3b_2\\
a_3b_1-a_1b_3\\
a_1b_2-a_2b_1
\end{pmatrix}
$$

有非常容易记忆的方式 将下面的行列式按第一行展开即可

$$
\vec{a} \times \vec{b} = 
\begin{vmatrix}
\vec{i} & \vec{j} & \vec{k} \\
a_1 & a_2 & a_3 \\
b_1 & b_2 & b_3
\end{vmatrix}
$$

***叉乘矩阵***

我们希望能找到一个矩阵$$A^*$$ 使得 $$\vec{a}\times\vec{b}=A^*\ \vec{b}$$ 这个矩阵就称为**叉乘矩阵**

对于列向量

$$
\vec{a}=\begin{pmatrix}
a_1\\
a_2\\
a_3
\end{pmatrix}
$$

它的叉乘矩阵就是

$$
A^*=\begin{pmatrix}
0 & -a_3 & a_2\\
a_3 & 0 & -a_1\\
-a_2 & a_1 & 0
\end{pmatrix}
$$

可以发现这个矩阵是一个斜对称矩阵 记忆方式为
主对角线全为0
1行2列 缺的是a3 1到2是顺序 对应的是负数
2行1列 缺的是a3 2到1是逆序 对应的是正数
3行2列 缺的是a1 3到2是逆序 对应的是正数
以此类推

那么就有

$$
\vec{a}\times\vec{b}=A^*\ \vec{b}=
\begin{pmatrix}
0 & -a_3 & a_2\\
a_3 & 0 & -a_1\\
-a_2 & a_1 & 0
\end{pmatrix}
\begin{pmatrix}
b_1\\
b_2\\
b_3
\end{pmatrix}
$$

实际上 上面的式子也是叉乘的矩阵乘法形式

***判断左右***

<div align="center">
  <img src="../images/4/3.png" alt="3.png" style="width: 50%; max-width: none;">
</div>


现在 $$\vec{b}$$ 在 $$\vec{a}$$ **左侧** 也就是说 从 $$\vec{a}$$ 向左旋转或者逆时针旋转 就可以到达 $$\vec{b}$$ 的方向 而 $$\vec{a}\times\vec{b}$$ 的方向是向着纸外的 是z轴的正方向 **是正的**

而 $$\vec{a}$$ 在 $$\vec{b}$$ **右侧** 也就是说 从 $$\vec{b}$$ 向右旋转或者顺时针旋转 就可以到达 $$\vec{a}$$ 的方向 $$\vec{b}\times\vec{a}$$ **是负的**

***判断内外***

<div align="center">
  <img src="../images/4/4.png" alt="4.png" style="width: 50%; max-width: none;">
</div>


判断点P是否在三角形内部 顶点A B C是逆时针摆放

$$\vec{AB}\times\vec{AP}$$ 的方向是向纸外的 那么P点就是在 $$\vec{AB}$$ 的左侧
$$\vec{BC}\times\vec{BP}$$ 的方向是向纸外的 那么P点就是在 $$\vec{BC}$$ 的左侧
$$\vec{CA}\times\vec{CP}$$ 的方向是向纸外的 那么P点就是在 $$\vec{CA}$$ 的左侧

则点P在三角形ABC的内部 否则至少有一边使得P点在某条边的右侧 

如果顶点是顺时针摆放 那么P点就会在三条边的右侧 **只要某个点一直在三条边的同侧 这个点就在三角形内部**
这是以后做光栅化的基础 我们要判断三角形覆盖了哪些像素 自然要知道这个像素是不是在三角形内部

如果得到的结果是0 到底算作是在三角形内部还是外部 这种情况就要自己决定了 说它在里面还是在外面都行

***矩阵乘法***

$$
(AB)C=A(BC)
$$

$$
A(B+C)=AB+AC
$$

$$
(A+B)C=AC+BC
$$

$$
(AB)^T=B^TA^T
$$

$$
AA^{-1}=I
$$

$$
(AB)^{-1}=B^{-1}A^{-1}
$$

矩阵和列向量(m×1)乘 那么肯定矩阵是放在左边

# 变换

***缩放***

$$
x'=s_1x
$$

$$
y'=s_2y
$$

$$
\begin{pmatrix}
x'\\
y'\\
\end{pmatrix}=
\begin{pmatrix}
s_1 & 0\\
0 & s_2\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
\end{pmatrix}
$$

***反射/对称***
$$
x'=-x
$$

$$
y'=y
$$

$$
\begin{pmatrix}
x'\\
y'\\
\end{pmatrix}=
\begin{pmatrix}
-1 & 0\\
0 & 1\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
\end{pmatrix}
$$

上面就是关于y轴对称

***切变***

<div align="center">
  <img src="../images/4/5.png" alt="5.png" style="width: 80%; max-width: none;">
</div>


纵坐标不表 底边不变 任何x水平方向的移动都是ay

$$
\begin{pmatrix}
x'\\
y'\\
\end{pmatrix}=
\begin{pmatrix}
1 & a\\
0 & 1\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
\end{pmatrix}
$$

***旋转***

<div align="center">
  <img src="../images/4/6.png" alt="6.png" style="width: 90%; max-width: none;">
</div>


默认绕原点旋转 **默认逆时针旋转**

$$
R_{\theta}=\begin{pmatrix}
cos\theta & -sin\theta\\
sin\theta & cos\theta\\
\end{pmatrix}
$$

$$
R_{-\theta}=\begin{pmatrix}
cos\theta & sin\theta\\
-sin\theta & cos\theta\\
\end{pmatrix}=R_\theta^T=R_\theta^{-1}
$$

偶旋转正交矩阵的逆就是转置
忘记了这个旋转矩阵就直接利用 (1, 0) (0, 1) 这两个点旋转的结果去推导就好了

## 齐次坐标

引入齐次坐标是因为平移变换比较特殊

<div align="center">
  <img src="../images/4/7.png" alt="7.png" style="width: 80%; max-width: none;">
</div>


$$
x'=x+t_x
$$

$$
y'=y+t_y
$$

x轴平移$$t_x$$ y轴平移$$t_y$$
就算写成矩阵形式 但这不是线性变换 这是仿射变换
$$
\begin{pmatrix}
x'\\
y'\\
\end{pmatrix}=
\begin{pmatrix}
a & b\\
c & d\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
\end{pmatrix}+
\begin{pmatrix}
t_x\\
t_y\\
\end{pmatrix}
$$

现在引入齐次坐标 把二维的点/向量增加一个维度

*二维的点*

$$
\begin{pmatrix}
x\\
y\\
1\\
\end{pmatrix}
$$

*二维的向量*

$$
\begin{pmatrix}
x\\
y\\
0\\
\end{pmatrix}
$$

向量的最后一维是0 是因为向量需要具有平移不变性

那么平移变换就可以写成

$$
\begin{pmatrix}
x'\\
y'\\
w'\\
\end{pmatrix}=
\begin{pmatrix}
1 & 0 & t_x\\
0 & 1 & t_y\\
0 & 0 & 1\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
1\\
\end{pmatrix}=
\begin{pmatrix}
x+t_x\\
y+t_y\\
1
\end{pmatrix}
$$

向量+向量=向量
点-点=向量
点+向量=点
点+点=？
比如 在w≠0时 都除以w 就变成一个点 (x/w, y/w) 了

$$
\begin{pmatrix}
x\\
y\\
w\\
\end{pmatrix}=
\begin{pmatrix}
x/w\\
y/w\\
1\\
\end{pmatrix}
$$


那么

$$
\begin{pmatrix}
x_1\\
y_1\\
1\\
\end{pmatrix}+
\begin{pmatrix}
x_2\\
y_2\\
1\\
\end{pmatrix}=
\begin{pmatrix}
x_1+x_2\\
y_1+y_2\\
2\\
\end{pmatrix}
$$

再除以2 就变成了

$$
\begin{pmatrix}
\frac{x_1+x_2}{2}\\
\frac{y_1+y_2}{2}\\
1\\
\end{pmatrix}
$$

会得到两个点的中点

现在任何一种变换(仿射变换)

$$
\begin{pmatrix}
x'\\
y'\\
\end{pmatrix}=
\begin{pmatrix}
a & b\\
c & d\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
\end{pmatrix}+
\begin{pmatrix}
t_x\\
t_y\\
\end{pmatrix}
$$

都可以写成

$$
\begin{pmatrix}
x'\\
y'\\
1\\
\end{pmatrix}=
\begin{pmatrix}
a & b & t_x\\
c & d & t_y\\
0 & 0 & 1\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
1\\
\end{pmatrix}
$$

***缩放***

$$
\begin{pmatrix}
s_x & 0 & 0\\
0 & s_y & 0\\
0 & 0 & 1\\
\end{pmatrix}
$$

***旋转***

$$
\begin{pmatrix}
cos\alpha & -sin\alpha & 0\\
sin\alpha & cos\alpha & 0\\
0 & 0 & 1\\
\end{pmatrix}
$$

***平移***

$$
\begin{pmatrix}
1 & 0 & t_x\\
0 & 1 & t_y\\
0 & 0 & 1\\
\end{pmatrix}
$$

二维条件下仿射变换 齐次坐标对应矩阵 最后一行都是 0 0 1

------

***逆变换***

对应的是乘以这个变换的逆矩阵

***变换的组合***

变换就是在某个向量前乘一个矩阵 再变换就在前面再乘一个 从右到左逐个使用矩阵

$$
A_n\dots A_2A_1
\begin{pmatrix}
x\\
y\\
1\\
\end{pmatrix}
$$

矩阵乘法没有交换律 所以矩阵乘的顺序调换了 结果就不一样了
矩阵乘法有结合律 所以可以把 $$A_n\dots A_2A_1$$ 先算出来 相当于变换可以组合起来

变换也可以**分解**
如果旋转变换不是以原点为中心变换 可以把旋转中心点平移到原点 当然其它点也会发生对应的移动 这之后再旋转

<div align="center">
  <img src="../images/4/8.png" alt="8.png" style="width: 80%; max-width: none;">
</div>

对应矩阵是从右到左排列 $$A_3A_2A_1$$

## 三维变换

点

$$
\begin{pmatrix}
x\\
y\\
z\\
1\\
\end{pmatrix}
$$

向量

$$
\begin{pmatrix}
x\\
y\\
z\\
0\\
\end{pmatrix}
$$

$$
\begin{pmatrix}
x\\
y\\
z\\
w\\
\end{pmatrix}
$$

w≠0 表示点 (x/w, y/w, z/w)

$$
\begin{pmatrix}
x'\\
y'\\
z'\\
1\\
\end{pmatrix}=
\begin{pmatrix}
a & b & c & tx\\
d & e & f & ty\\
g & h & i & tz\\
0 & 0 & 0 & 1\\
\end{pmatrix}
\begin{pmatrix}
x\\
y\\
z\\
1\\
\end{pmatrix}
$$

***缩放***

$$
\begin{pmatrix}
s_x & 0 & 0 & 0\\
0 & s_y & 0 & 0\\
0 & 0 & s_z & 0\\
0 & 0 & 0 & 1\\
\end{pmatrix}
$$

***平移***

$$
\begin{pmatrix}
1 & 0 & 0 & tx\\
0 & 1 & 0 & ty\\
0 & 0 & 1 & tz\\
0 & 0 & 0 & 1\\
\end{pmatrix}
$$

<span id="mypoint_1"></span>***旋转***

***绕着某个轴旋转***

角度为 $$\theta$$ 比如绕着x轴旋转 y z都在旋转 x是不变的

*绕x轴旋转矩阵* roll
$$
R_\mathcal{X}(\theta)=\begin{pmatrix}
1 & 0 & 0 & 0\\
0 & cos\theta & -sin\theta & 0\\
0 & sin\theta & cos\theta & 0\\
0 & 0 & 0 & 1\\
\end{pmatrix}
$$

可以发现 其中有

$$
\begin{pmatrix}
cos\theta & -sin\theta\\
sin\theta & cos\theta\\
\end{pmatrix}
$$

这就是二维旋转矩阵 无非是对y z做角度为 $$\theta$$ 的旋转

*绕z轴旋转矩阵* yaw
$$
R_\mathcal{Z}(\theta)=\begin{pmatrix}
cos\theta & -sin\theta & 0 & 0\\
sin\theta & cos\theta & 0 & 0\\
0 & 0 & 1 & 0\\
0 & 0 & 0 & 1\\
\end{pmatrix}
$$

还是能从中提取出

$$
\begin{pmatrix}
cos\theta & -sin\theta\\
sin\theta & cos\theta\\
\end{pmatrix}
$$

就是二维旋转矩阵 是对于x y做的角度为 $$\theta$$ 的旋转

*绕y轴旋转矩阵* pitch
$$
R_\mathcal{Y}(\theta)=\begin{pmatrix}
cos\theta & 0 & sin\theta & 0\\
0 & 1 & 0 & 0\\
-sin\theta & 0 & cos\theta & 0\\
0 & 0 & 0 & 1\\
\end{pmatrix}
$$

现在提取出来的变成了

$$
\begin{pmatrix}
cos\theta & sin\theta\\
-sin\theta & cos\theta\\
\end{pmatrix}
$$

发生了转置 这是为什么？

右手系

$$
\mathcal{X}\times\mathcal{Y}=\mathcal{Z}
$$

$$
\mathcal{Y}\times\mathcal{Z}=\mathcal{X}
$$

$$
\mathcal{Z}\times\mathcal{X}=\mathcal{Y}
$$

它是循环的 是 $$\mathcal{Z}\times\mathcal{X}=\mathcal{Y}$$ 而不是 $$\mathcal{X}\times\mathcal{Z}=\mathcal{Y}$$
二维 默认就是x y平面直角坐标系 逆时针旋转 $$\theta$$
三维 绕y轴旋转 其实是x z在旋转

$$\mathcal{X}\times\mathcal{Y}=\mathcal{Z}$$ 所以绕z轴旋转时 z轴的坐标是不变的 那么现在就可以忽略掉z轴上的坐标 将它拍扁了投影到二维平面之上 认为是二维上的x y坐标轴形成的平面 在整体性地进行逆时针的旋转 角度为 $$\theta$$

<div align="center">
  <img src="../images/4/9.png" alt="9.png" style="width: 30%; max-width: none;">
</div>

右手系 现在向着纸外的就是z轴

同理 $$\mathcal{Y}\times\mathcal{Z}=\mathcal{X}$$ 绕x轴旋转时 是y z坐标轴形成的平面 逆时针旋转角度 $$\theta$$

<div align="center">
  <img src="../images/4/10.png" alt="10.png" style="width: 30%; max-width: none;">
</div>

右手系 现在向着纸外的就是x轴

那么 $$\mathcal{Z}\times\mathcal{X}=\mathcal{Y}$$ 绕y轴旋转 就是z x坐标轴形成的平面 逆时针旋转角度 $$\theta$$

<div align="center">
  <img src="../images/4/11.png" alt="11.png" style="width: 30%; max-width: none;">
</div>

右手系 现在向着纸外的就是y轴 我们从纸外往里看 y轴的正方向是指着我们的 我们看到了z x这个坐标平面 它要逆时针旋转

但我们通常写坐标的顺序是x y z 写成齐次坐标就是

$$
\begin{pmatrix}
x\\
y\\
z\\
1\\
\end{pmatrix}
$$

那么对于x z坐标形成的平面

<div align="center">
  <img src="../images/4/12.png" alt="12.png" style="width: 30%; max-width: none;">
</div>

根据右手系 现在向着纸外的是-y 我们要站在纸内里面 往纸外看 才能复现看到我们之前看到的 指着我们的y轴的正方向 也就可以再一次看到正在逆时针旋转着的z x坐标平面 但是对于纸外的人来说 它看到的必然是顺时针旋转的x z坐标平面

<div align="center">
  <img src="../images/4/13.png" alt="13.png" style="width: 80%; max-width: none;">
</div>
顺时针旋转了角度 $$\theta$$ 也即逆时针旋转角度 $$-\theta$$
而 $$R_{-\theta}=R_\theta^T$$ 所以那个提取出来的二维旋转矩阵才是发生了转置

***任何一个三维的旋转都可以写成绕x轴 y轴 z轴旋转的组合***
$$
R_{\mathcal{X}\mathcal{Y}\mathcal{Z}}(\alpha,\beta,\gamma)=R_{\mathcal{X}}(\alpha)R_{\mathcal{Y}}(\beta)R_{\mathcal{Z}}(\gamma)
$$

<div align="center">
  <img src="../images/4/14.png" alt="14.png" style="width: 50%; max-width: none;">
</div>

一个人
绕着x轴旋转 roll 滚转
绕着y轴旋转 pitch 俯仰 抬头低头
绕着z轴旋转 yaw 偏航 左右转头

